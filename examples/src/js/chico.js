/**
  * Chico-UI
  * Packer-o-matic
  * Like the pizza delivery service: "Les than 100 milisecons delivery guarantee!"
  * @components: core, position, object, floats, navs, carousel, dropdown, layer, modal, tabNavigator, tooltip, validator
  * @version 0.2
  * @autor Natan Santolo <natan.santolo@mercadolibre.com>
  *
  * Based on:
  * @package JSMin
  * @author Ryan Grove <ryan@wonko.com>
  * @copyright 2002 Douglas Crockford <douglas@crockford.com> (jsmin.c)
  * @copyright 2008 Ryan Grove <ryan@wonko.com> (PHP port)
  * @license http://opensource.org/licenses/mit-license.php MIT License
  * @version 1.1.1 (2008-03-02)
  * @link http://code.google.com/p/jsmin-php/
  */
;(function($){

var ui=window.ui={version:"0.4.5",components:"carousel,dropdown,layer,modal,tabNavigator,tooltip,validator",internals:"position,object,floats,navs",instances:{},init:function(){$("html").removeClass("no-js");ui.components=(window.components)?ui.components+","+window.components:ui.components;ui.internals=(window.internals)?ui.internals+","+window.internals:ui.internals;$(ui.components.split(",")).each(function(i,e){ui.factory({component:e});});},utils:{body:$('body'),html:$('html'),window:$(window),document:$(document)}}
ui.factory=function(o){if(!o){alert("Factory fatal error: Need and object {component:\"\"} to configure a component.");return;};if(!o.component){alert("Factory fatal error: No component defined.");return;};var x=o.component;if(!ui.instances[x]){ui.instances[x]=[];}
var create=function(x){$.fn[x]=function(options){var results=[];var that=this;var options=options||{};if(typeof options!=="object"){alert("Factory "+x+" configure error: Need a basic configuration.");return;};that.each(function(i,e){var conf={};conf.name=x;conf.element=e;conf.id=i;$.extend(conf,options);var created=ui[x](conf);results.push(created);ui.instances[x].push(created);});return(results.length>1)?results:results[0];}
if(o.callback){o.callback();}}
if(ui[o.component]){create(o.component);}else{ui.get({"method":"component","component":o.component,"script":(o.script)?o.script:"src/js/"+o.component+".js","styles":(o.style)?o.style:"src/css/"+x+".css","callback":create});}}
ui.get=function(o){switch(o.method){case"content":var result;var x=o.conf;x.$htmlContent.html('<div class="loading"></div>');$.ajax({url:x.content.data,type:x.ajaxType||'POST',data:x.ajaxParams||'x=x',cache:true,async:false,success:function(data){result=data;},error:function(data){result=false;}});return result;break;case"component":if(o.style){var style=document.createElement('link');style.href=o.style;style.rel='stylesheet';style.type='text/css';}
if(o.script){var script=document.createElement("script");script.src=o.script;}
var head=document.getElementsByTagName("head")[0]||document.documentElement;var done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){done=true;if(o.callback){o.callback(o.component);}
script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}}};if(o.script){head.insertBefore(script,head.firstChild);}
if(o.style){head.appendChild(style);}
break;}}
ui.position={center:function(conf){var align=function(){conf.$htmlContent.css({left:(parseInt(ui.utils.window.width())-conf.$htmlContent.outerWidth())/2,top:(ui.utils.html.hasClass('ie6'))?'':(parseInt(ui.utils.window.height())-conf.$htmlContent.outerHeight())/2});};align();ui.utils.window.bind('resize',align);},down:function(conf){var align=function(){conf.$htmlContent.css({top:conf.$wrapper.outerHeight()+10,left:(conf.$wrapper.outerWidth()/2)-20});};align();ui.utils.window.bind('resize',align);},right:function(conf){var align=function(){conf.$htmlContent.css({top:(conf.$wrapper.height()/2)-11,left:conf.$wrapper.outerWidth()+13});};align();ui.utils.window.bind('resize',align);},follow:function(conf){conf.$trigger.bind('mousemove',function(event){conf.$htmlContent.css({top:event.pageY+20,left:event.pageX-32});});}}
ui.object=function(){var that=this;return{prevent:function(event){if(event){event.preventDefault();event.stopPropagation();}},loadContent:function(conf){if(typeof conf.content!=='object'||!conf.content.type){alert('UI: "content" attribute error.');return;}else{switch(conf.content.type.toLowerCase()){case'ajax':var result=ui.get({method:"content",conf:conf});return result||'<p>Error on ajax call</p>';break;case'dom':return $(conf.content.data).html();break;case'param':return conf.content.data;break;};};},callbacks:function(conf,when){if(conf.callbacks&&conf.callbacks[when])conf.callbacks[when](conf);},publish:{}};}
ui.floats=function(){var that=ui.object();var clearTimers=function(){clearTimeout(st);clearTimeout(ht);};var createClose=function(conf){$('<p class="btn close">x</p>').bind('click',function(event){that.hide(event,conf);}).prependTo(conf.$htmlContent);};var createCone=function(conf){$('<div class="cone'+((conf.align)?' '+conf.align:'')+'"></div>').prependTo(conf.$htmlContent);};that.show=function(event,conf){that.prevent(event);if(conf.visible)return
var className='ui-'+conf.name;if(conf.wrappeable){conf.$trigger.addClass(className+'-trigger');conf.$htmlContent=$('<div class="'+className+'-content">');conf.$trigger.wrap($('<div class="'+className+'">'));conf.$wrapper=conf.$trigger.parent();conf.$wrapper.css({display:conf.$trigger.css('display'),position:'relative',marginTop:conf.$trigger.css('marginTop'),marginRight:conf.$trigger.css('marginRight'),marginLeft:conf.$trigger.css('marginLeft'),marginBottom:conf.$trigger.css('marginBottom'),paddingTop:conf.$trigger.css('paddingTop'),paddingRight:conf.$trigger.css('paddingRight'),paddingLeft:conf.$trigger.css('paddingLeft'),paddingBottom:conf.$trigger.css('paddingBottom')});conf.$htmlContent.html(that.loadContent(conf)).hide().appendTo(conf.$wrapper);}else{conf.$htmlContent=$('<div class="'+className+'">');conf.$htmlContent.html(that.loadContent(conf)).hide().appendTo('body');};if(conf.closeButton)createClose(conf);if(conf.cone)createCone(conf);if(conf.align)ui.position[conf.align](conf);if(conf.classes)conf.$htmlContent.addClass(conf.classes);conf.visible=true;conf.$htmlContent.fadeIn('fast',function(){that.callbacks(conf,'show');});};that.hide=function(event,conf){that.prevent(event);if(!conf.visible)return;var className='ui-'+conf.name;if(conf.wrappeable){conf.$wrapper.find('.'+className+'-trigger').removeClass(className+'-trigger');conf.$wrapper.find('.'+className+'-content').unwrap().remove();}else{$('.'+className).fadeOut('fast',function(event){$(this).remove();});};conf.visible=false;that.callbacks(conf,'hide');};return that;}
ui.navs=function(){var that=ui.object();that.status=false;that.show=function(event,conf){that.prevent(event);that.status=true;conf.$trigger.addClass('on');conf.$htmlContent.show();that.callbacks(conf,'show');};that.hide=function(event,conf){that.prevent(event);that.status=false;conf.$trigger.removeClass('on');conf.$htmlContent.hide();that.callbacks(conf,'hide');};return that;}
ui.carousel=function(conf){var that=ui.object();var status=false;conf.$trigger=$(conf.element).addClass('ui-carousel');conf.$htmlContent=$(conf.element).find('.carousel').addClass('ui-carousel-content');var htmlElementMargin=($.browser.msie&&$.browser.version=='6.0')?21:20;var htmlContentWidth=conf.$htmlContent.children().size()*(conf.$htmlContent.children().outerWidth()+htmlElementMargin);conf.$htmlContent.wrap($('<div>').addClass('mask')).css('width',htmlContentWidth);var $mask=conf.$trigger.find('.mask');var steps=~~((conf.$trigger.width()-70)/(conf.$htmlContent.children().outerWidth()+20));steps=(steps==0)?1:steps;var moveTo=(conf.$htmlContent.children().outerWidth()+20)*steps;var margin=($mask.width()-moveTo)/2;$mask.width(moveTo).height(conf.$htmlContent.children().outerHeight());if(conf.arrows!=false)$mask.css('marginLeft',margin);var prev=function(event){if(status)return;var htmlContentPosition=conf.$htmlContent.position();status=true;conf.$htmlContent.animate({left:htmlContentPosition.left+moveTo},function(){htmlContentPosition=conf.$htmlContent.position();if(htmlContentPosition.left>=0)prevButton.hide();nextButton.show();status=false;});};if($.browser.msie&&$.browser.version=='6.0')htmlContentWidth=htmlContentWidth-(conf.$htmlContent.children().outerWidth()*2);var next=function(event){if(status)return;var htmlContentPosition=conf.$htmlContent.position();status=true;conf.$htmlContent.animate({left:htmlContentPosition.left-moveTo},function(){htmlContentPosition=conf.$htmlContent.position();if(htmlContentPosition.left+htmlContentWidth<=$mask.width())nextButton.hide();prevButton.show();status=false;});};var prevButton=$('<p>').html('Previous').addClass('prev').bind('click',prev).hide().css('top',(conf.$htmlContent.children().outerHeight()-57)/2+10);var nextButton=$('<p>').html('Next').addClass('next').bind('click',next).hide().css('top',(conf.$htmlContent.children().outerHeight()-57)/2+10);if(conf.arrows!=false){conf.$trigger.prepend(prevButton).append(nextButton);if(htmlContentWidth>$mask.width()){nextButton.show();}};that.publish={uid:conf.id,element:conf.element,type:"ui.carousel",next:function(event){next(event)},prev:function(event){prev(event)}}
return that.publish;};ui.dropdown=function(conf){var that=ui.navs();$(conf.element).addClass('ui-dropdown');conf.$trigger=$(conf.element).children(':first');conf.$htmlContent=conf.$trigger.next().bind('click',function(event){event.stopPropagation()});conf.$trigger.bind('click',function(event){if(that.status){that.hide(event,conf);return;};$(ui.instances.dropdown).each(function(i,e){e.hide()});that.show(event,conf);$(document).bind('click',function(event){that.hide(event,conf);$(document).unbind('click');});}).css('cursor','pointer').addClass('ui-dropdown-trigger').append('<span class="down">&raquo;</span>');conf.$htmlContent.addClass('ui-dropdown-content').find('a').bind('click',function(){hide($.Event())});var show=function(event){that.show(event,conf);};var hide=function(event){that.hide(event,conf);};that.publish={uid:conf.id,element:conf.element,type:"ui.dropdown",show:function(event){show(event,conf)},hide:function(event){hide(event,conf)}}
return that.publish;};ui.layer=function(conf){var that=ui.floats();conf.$trigger=$(conf.element);conf.align='down';conf.cone=true;conf.classes='box';conf.wrappeable=true;conf.visible=false;if(conf.event==='click'){conf.closeButton=true;conf.$trigger.css('cursor','pointer').bind('click',function(event){that.show(event,conf);$('.uiLayer').bind('click',function(event){event.stopPropagation()});$(document).bind('click',function(event){that.hide(event,conf);$(document).unbind('click');});});}else{conf.$trigger.css('cursor','default').bind('mouseover',function(event){that.show(event,conf);}).bind('mouseout',function(event){that.hide(event,conf);});};that.publish={uid:conf.id,element:conf.element,type:"ui.layer",content:conf.content.data,show:function(event){show(event,conf)},hide:function(event){hide(event,conf)}}
return that.publish;};ui.modal=function(conf){var that=ui.floats();conf.$trigger=$(conf.element);conf.closeButton=true;conf.align='center';conf.classes='box';conf.wrappeable=false;conf.ajaxType='POST';var show=function(event){if(conf.content.type.toLowerCase()==='ajax'){conf.content.data=conf.$trigger.attr('href')||conf.$trigger.parents('form').attr('action');conf.ajaxParams='x=x';if(conf.$trigger.attr('type')=='submit')setAjaxConfig();};dimmer.on();that.show(event,conf);$('.ui-modal .btn.close, .closeModal').bind('click',hide);conf.$trigger.blur();};var hide=function(event){dimmer.off();that.hide(event,conf);};var setAjaxConfig=function(){if(conf.content.data=='')alert('UI: Modal ajax configuration error.');conf.ajaxType=conf.$trigger.parents('form').attr('method')||'POST';var serialized=conf.$trigger.parents('form').serialize();conf.ajaxParams=conf.ajaxParams+((serialized!='')?'&'+serialized:'');};var dimmer={on:function(){$('<div>').bind('click',function(event){hide(event)}).addClass('ui-dimmer').css({height:$(window).height(),display:'block'}).hide().appendTo('body').fadeIn();},off:function(){$('div.ui-dimmer').fadeOut('normal',function(){$(this).remove();});}};conf.$trigger.css('cursor','pointer').bind('click',function(event){show(event)});that.publish={uid:conf.id,element:conf.element,type:"ui.modal",content:conf.content.data,show:function(event){show(event)},hide:function(event){hide(event)}}
return that.publish;};ui.tabNavigator=function(conf){var that=ui.object();var $triggers=$(conf.element).children(':first').find('a');var $htmlContent=$(conf.element).children(':first').next();var instances=[];$(conf.element).addClass('ui-tabNavigator');$triggers.addClass('ui-tabNavigator-trigger');$htmlContent.addClass('ui-tabNavigator-content box');$.each($triggers,function(i,e){instances.push(ui.tab(i,e,conf));});var show=function(event,tab){ui.instances.tabNavigator[conf.instance].tabs[tab].shoot(event);};that.publish={uid:conf.id,element:conf.element,type:"ui.tabNavigator",tabs:instances,show:function(event){show(event,tab)},hide:function(event){hide(event,tab)}}
return that.publish;};ui.tab=function(index,element,conf){var that=ui.navs();var display=element.href.split('#');var $tabContent=$(element).parents('.ui-tabNavigator').find('#'+display[1]);that.conf={name:'tab',$trigger:$(element).addClass('ui-tabNavigator-trigger'),callbacks:conf.callbacks};var results=function(){if($tabContent.attr('id')){return $tabContent;}else{that.conf.content={type:'ajax',data:element.href};var w=$('<div>').attr('id','ui-tab'+index);w.hide().appendTo(that.conf.$trigger.parents('.ui-tabNavigator').find('.ui-tabNavigator-content'));return w;};};that.conf.$htmlContent=results();if(index==0){that.status=true;that.conf.$trigger.addClass('on');};if(!that.status)that.conf.$htmlContent.hide();that.shoot=function(event){that.prevent(event);var tabs=ui.instances.tabNavigator[conf.id].tabs;if(tabs[index].status)return;$.each(tabs,function(i,e){if(e.status)e.hide(event,e.conf);});if(that.conf.$htmlContent.html()==='')that.conf.$htmlContent.html(that.loadContent(that.conf));that.show(event,that.conf);};that.conf.$trigger.bind('click',that.shoot);return that;}
ui.tooltip=function(conf){var that=ui.floats();conf.name='tooltip';conf.align='down';conf.cone=true;conf.content={type:'param',data:conf.element.title};conf.wrappeable=true;conf.visible=false;conf.$trigger=$(conf.element).css('cursor','default').bind('mouseenter',function(event){$(this).attr('title','');that.show(event,conf);}).bind('mouseleave',function(event){$(this).attr('title',conf.content.data);that.hide(event,conf);});that.publish={uid:conf.id,element:conf.element,type:"ui.tooltip",content:conf.content.data,show:function(event){show(event,conf)},hide:function(event){hide(event,conf)}}
return that.publish;};ui.validator=function(conf){var that=ui.object();var validation=true;var watchers=[];$(conf.element).bind('submit',function(event){that.prevent(event);});$(conf.element).find('input[type=submit]').unbind('click');var Watcher=function(wconf){if(wconf.$element.hasClass('options')){wconf.tag='OPTIONS';if(wconf.$element.hasClass('required'))wconf.$element=(((wconf.$element.find('h4').length>0)?wconf.$element.find('h4'):false)||((wconf.$element.prev().attr('tagName')=='LEGEND')?wconf.$element.prev():false)||wconf.$element);}else{wconf.$element.bind('blur',function(event){wconf.event=event;watchers[wconf.id].status=validate(wconf);});};return{status:true,helper:ui.helper(wconf)};};var validations=function(method,wconf){var value=wconf.$element.val();switch(method){case'text':return value.match(/^([a-zA-Z\s]+)$/m);break;case'number':return!isNaN(value);break;case'email':return value.match(/^(("[\w-\s]+")|([\w-]+(?:\.[\w-]+)*)|("[\w-\s]+")([\w-]+(?:\.[\w-]+)*))(@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i);break;case'url':return value.match(/^(http:\/\/www.|https:\/\/www.|ftp:\/\/www.|www.){1}([\w]+)(.[\w]+){1,2}$/);break;case'range':return validations('number',wconf)&&validations('min',wconf)&&validations('max',wconf);break;case'required':return(wconf.tag=='SELECT')?value!=-1:$.trim(value).length>0;break;case'min':return value>=parseInt(wconf.$element.attr('min'));break;case'max':return value<=parseInt(wconf.$element.attr('max'));break;case'minLength':return value.length>=parseInt(wconf.messages.minLength[0]);break;case'maxLength':return value.length<=parseInt(wconf.messages.maxLength[0]);break;};};var validate=function(wconf){var helper=watchers[wconf.id].helper;for(var x in wconf.messages){if(wconf.$element.parents('label').hasClass('disabled')&&wconf.$element.attr('disabled'))break;if(!wconf.$element.parents('label').hasClass('required')&&!validations('required',wconf))break;if(!validations(x,wconf)){if(wconf.event.type=='blur')return false;wconf.$element.addClass('error');if($('.helper'+wconf.id))helper.hide();if(x=='minLength'||x=='maxLength')helper.show(wconf.messages[x][1]);else helper.show(wconf.messages[x]);return false;};};if(wconf.$element.hasClass('error')){helper.hide();wconf.$element.removeClass('error');};if(wconf.event.type==='submit')return true;validation=true;$.each(watchers,function(i,e){if(i!=wconf.id&&!e.status)validation=false});if(validation)removeValidation();return true;};var removeValidation=function(){$('.ui-validator').fadeOut('fast',function(){$(this).remove();});};$(conf.element).bind('submit',function(event){that.prevent(event);if(!validation){removeValidation();validation=true;};var index=0;for(var x in conf.fields){var helper=watchers[index].helper;if(!$(x).hasClass('options')){var wconf={id:index,$element:$(x),tag:$(x).attr('tagName'),messages:conf.fields[x],event:event};if(!validate(wconf)){watchers[index].status=false;validation=false;}else{$(x).removeClass('error');helper.hide();};}else{if($(x).find('input:checked').length===0){if($('.helper'+index))helper.hide();helper.show(conf.fields[x]['required']);watchers[index].status=false;validation=false;}else{helper.hide();};};index++;};if(!validation){$(conf.element).before('<p class="ui-validator"><span class="ico error">Error: </span>'+conf.defaults.error+'</p>');}else{removeValidation();if(conf.callbacks&&conf.callbacks.submit)conf.callbacks.submit();else conf.element.submit();};});for(var x in conf.fields){var wconf={id:watchers.length,$element:$(x),tag:$(x).attr('tagName'),messages:conf.fields[x]};watchers.push(Watcher(wconf));};that.publish={uid:conf.id,element:conf.element,type:"ui.validator",fields:watchers,validate:function(event){validate()}}};ui.helper=function(wconf){var that=ui.floats();var conf={name:'helper',$trigger:wconf.$element,align:'right',cone:true,content:{type:'param'},classes:'helper'+wconf.id,wrappeable:true,visible:false};var hide=function(){wconf.$element.removeClass('ui-helper-trigger');$('.helper'+wconf.id).unwrap().remove();conf.visible=false;that.callbacks(conf,'hide');};var show=function(text){conf.content.data='<span class="ico error">Error: </span>'+text;that.show($.Event(),conf);if(ui.utils.html.hasClass('ie7'))$('.helper'+wconf.id).parent().css('display','inline');if(wconf.tag=='INPUT')$('.helper'+wconf.id).parent().css({margin:0,padding:0});};return{show:function(text){show(text)},hide:hide};};
ui.init();
})(jQuery);