<!doctype html>
<!--[if IE]><![endif]-->
<!--[if lt IE 7 ]> <html lang="es" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="es" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="es" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="es" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="es" class="no-js"> <!--<![endif]-->
	<head>
		<script></script>
		<meta charset="utf-8">
		<title>Chico UI, MercadoLibre's Visual Framework</title>
		<link rel="stylesheet" href="./build/chico.css">
		<link rel="stylesheet" href="./src/css/mesh.css">
		<style>

.class {

}

.abstract {
    color: #999;
}

.interface {

}
		</style>
	</head>
<body>
	<div class="container">
		<div class="ch-g1">
			<div class="box">
				<h1>Custom Download</h1>

<form id="downloadForm" action="php/packer.php" method="get">

<div class="ch-g1-4">
<div class="rightcolumn">
<fieldset>
	<legend>Abstracts:</legend>
	<div class="options">
		<ul id="abstracts"></ul>
	</div>
	<legend>Utils:</legend>
	<div class="options">
		<ul id="utils"></ul>
	</div>
</fieldset>
</div>
</div>

<div class="ch-g1-4">
<div>
<fieldset>
	<legend>Components:</legend>
	<div class="options">
		<ul id="components"></ul>
	</div>
</fieldset>
</div>
</div>

<div class="ch-g1-4">
<div>
<fieldset>
<fieldset>
    <legend>Flavors:</legend>
    <div class="options">
        <ul>
            <li class="fieldBox">
                <label for="ml_theme">
                    <input type="radio" value="ml" id="ml_theme" name="theme" checked="checked">
                    <span>MercadoLibre</span>
                </label>
            </li>

            <li class="fieldBox">
                <label for="mp_theme">
                    <input type="radio" value="mp" id="mp_theme" name="theme">
                    <span>MercadoPago</span>
                </label>
            </li>

            <li class="fieldBox">
                <label for="ms_theme">
                    <input type="radio" value="ms" id="ms_theme" name="theme">
                    <span>MercadoShops</span>
                </label>
            </li>
        </ul>
    </div>
    
    <legend>Options:</legend>
    <div class="options">
        <ul>

            <li class="fieldBox">
                <label>
                    <input type="checkbox" value="base64">
                    <span>Embed images</span>
                </label>
            </li>
            <li class="fieldBox">
                <label>
                    <input type="checkbox" value="mesh">
                    <span>Include Mesh</span>
                </label>
            </li>
            
        </ul>
    </div>
</fieldset>

</div>
</div>

<div class="ch-g1-4">
<div class="leftcolumn">

<fieldset>

    <legend>Environment:</legend>
    <div class="options">
        <ul>
            <li class="fieldBox">
                <label>
                    <input type="checkbox" value="production" checked="checked">
                    <span>Production <small>(minified)</small></span>
                </label>
            </li>
            <li class="fieldBox">
                <label>
                    <input type="checkbox" value="development">
                    <span>Development <small>(with comments)</small></span>
                </label>
            </li>
        </ul>
     </div>

    <legend>Summary:</legend>
    <div class="summary">
        <ul>
            <li>Selected: <span class="selected-components">0</span>.</li>
            <li>Total size: <span class="total-size">0</span>kbs.</li>
        </ul>
    </div>
    <input type="submit" value="Download" class="btn primary">    
</fieldset>

</div>
</div>

<div class="clearfix"></div>
</form>

				
				
			</div>
		</div>
</div>

<p class="footer">Chico-UI, powered by <a href="http://www.mercadolibre.com">MercadoLibre</a>.</p>

<script src="./libs/js/jquery.js"></script>
<script src="./build/chico.js"></script>
<script src="inheritanceMap.js"></script>

<script>

var build_version = {};

var components = [];
var utils = [];

for (var c in map) {
    var type = map[c].type;
    var value = c.toString();
    var appendTo = (type == "class" || type == "interface") ? "#components" : (type == "abstract") ? "#abstracts" : "#utils" ;  
    var className = "fieldBox " + type;
    var disabled = (type == "abstract") ? "disabled=\"disabled\"" : "" ;
    $("<li class=\""+className+"\"><label><input type=\"checkbox\" value=\""+value+"\" name=\"get\" "+disabled+"> <span>"+c+"</span></label>")
        .appendTo(appendTo);
}

var checkIt = function(c) {
    $("input[value="+c+"]").attr("checked","checked");
}

var unCheckIt = function(c) {

    if (isShared(c)) { 
        return; 
    }

    $("input[value="+c+"]").removeAttr("checked");
}

var isShared = function(c) {
    
    var r = false;
    
    $("input:checked").each(function(event){
    
        var t = map[$(this).val()];
        
        if (!t) return;
        
        if (t.inheritance && c == t.inheritance ||Â t.implements && c == t.implements) {
            r = true;    
        }
                
        if (t.depends) {
            if (t.depends.join(",").indexOf(c) > -1) {
                r = true;
            }
        }

    });
    
    return r;    
}

var checkMap = function(c) {

    if (!c) { return; }

    if (c.implements) {

        action(c.implements);

        checkMap(map[c.implements]);
    }

    if (c.inheritance) {

        action(c.inheritance);

        checkMap(map[c.inheritance]); 

    }
    if (c.depends) {
        
        $(c.depends).each(function(i,e){

            action(e);

            checkMap(map[e]); 
        
        });  
    }
    
    $(".selected-components").html( $("#components input:checked").size() + $("#abstracts input:checked").size() + $("#utils input:checked").size());
}

var action = checkIt;

$("#components input, #utils input").change(function(e){
    
    var c = map[$(this).val()];
        
    action = (!$(this).attr("checked")) ? unCheckIt : checkIt ;
    
    // Check the map
    checkMap(c);

});
       
</script>
</body>
</html>