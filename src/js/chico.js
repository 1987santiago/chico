/**
 *    Chico-UI
 *    Packer-o-matic
 *    version 0.1
 */
;(function($){
var ui=window.ui={version:"0.4.2",mode:"dev",components:"carousel, dropdown, editinPlace, layer, modal, tabNavigator, tooltip, validator",instances:{},init:function(){ui.components=(window.components)?ui.components+" "+window.components:ui.components;ui.factory("create");},utils:{body:$('body'),window:$(window),document:$(document),ucfirst:function(s){return(s+'').charAt(0).toUpperCase()+s.substr(1);}}}
ui.environment=function(mode,config){switch(mode){case"pub":return{uri:"http://10.100.34.210:8080/content/chico/"+ui.version+"/php/",css:"css.php?q="+config,js:"js.php?q="+config}
break;case"dev":return{uri:"src/",css:"css/"+config+".css",js:"js/"+config+".js"}
break;}}
ui.factory=function(method,x,callback){switch(method){case"create":var fns=ui.components.split(", ");var tot=fns.length;for(var i=0;i<tot;i++){var x=fns[i];ui.factory("configure",x);}
break;case"configure":if(!ui.instances[x])ui.instances[x]=[];var create=function(x){$.fn[x]=function(options){var results=[];var that=this;var options=options||{};if(typeof options!=='object'){alert('UI: '+x+' configuration error.');return;};that.each(function(i,e){var conf={};conf.name=x;conf.element=e;conf.id=i;$.extend(conf,options);var created=ui[x](conf);results.push(created);ui.instances[x].push(created);});return(results.length>1)?results:results[0];}
if(callback)callback();}
if(ui[x]){create(x);}else{ui.get("component",x,create);}
break;default:break;}}
ui.get=function(method,x,callback){switch(method){case"content":var result;x.$htmlContent.html('<div class="loading"></div>');$.ajax({url:x.content.data,type:x.ajaxType||'POST',data:x.ajaxParams||'x=x',cache:true,async:false,success:function(data){result=data;},error:function(data){result=false;}});return result;break;case"all":var c=x.split(" ");var x=c.join(",");case"component":var url=ui.environment(ui.mode,x);var src=url.uri+url.js;var href=url.uri+url.css;var style=document.createElement('link');style.href=href;style.rel='stylesheet';style.type='text/css';var script=document.createElement("script");script.src=src;default:var head=document.getElementsByTagName("head")[0]||document.documentElement;var done=false;script.onload=script.onreadystatechange=function(){if(!done&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){done=true;if(method=="all"){for(var i=0;i<c.length;i++){ui.instances[c[i]]=[];ui.instances[c[i]].script=script;ui.instances[c[i]].style=style;}}else{ui.instances[x].script=script;ui.instances[x].style=style;}
callback(x);script.onload=script.onreadystatechange=null;if(head&&script.parentNode){head.removeChild(script);}}};head.insertBefore(script,head.firstChild);head.appendChild(style);return x;break;}}
ui.positionator={center:function(conf){var align=function(){conf.$htmlContent.css({left:(parseInt(ui.utils.window.width())-conf.$htmlContent.outerWidth())/2,top:($.browser.msie&&$.browser.version=='6.0')?'':(parseInt(ui.utils.window.height())-conf.$htmlContent.outerHeight())/2});};align();ui.utils.window.bind('resize',align);},drop:function(conf){console.log(conf);var os=conf.$trigger.offset();var align=function(){conf.$htmlContent.css({top:os.top+conf.$trigger.outerHeight()+10,left:os.left+(conf.$trigger.outerWidth()/2)-20});};align();ui.utils.window.bind('resize',align);},right:function(conf){var os=conf.$trigger.offset();var align=function(){conf.$htmlContent.css({top:os.top+(conf.$trigger.outerHeight()/2)-11,left:os.left+conf.$trigger.outerWidth()+10});};align();ui.utils.window.bind('resize',align);},follow:function(conf){conf.$trigger.bind('mousemove',function(event){conf.$htmlContent.css({top:event.pageY+20,left:event.pageX-32});});}}
ui.object=function(){var that=this;return{prevent:function(event){if(event){event.preventDefault();event.stopPropagation();}},loadContent:function(conf){if(typeof conf.content!=='object'||!conf.content.type){alert('UI: "content" attribute error.');return;}else{switch(conf.content.type.toLowerCase()){case'ajax':var result=ui.get('content',conf);return result||'<p>Error on ajax call</p>';break;case'dom':return $(conf.content.data).html();break;case'param':return conf.content.data;break;};};},callbacks:function(conf,when,handler){if(conf.callbacks&&conf.callbacks[when])conf.callbacks[when]();}};}
ui.floats=function(){var that=ui.object();var clearTimers=function(){clearTimeout(st);clearTimeout(ht);};var createClose=function(conf){$('<p class="btn close">x</p>').bind('click',function(event){that.hide(event,conf);}).prependTo(conf.$htmlContent);};var createCone=function(conf){$('<div class="cone'+((conf.align)?' '+conf.align:'')+'"></div>').prependTo(conf.$htmlContent);};that.show=function(event,conf){that.prevent(event);conf.$htmlContent=$('<div>').addClass('ui'+ui.utils.ucfirst(conf.name));conf.$htmlContent.html(that.loadContent(conf)).hide().appendTo('body');if(conf.closeButton)createClose(conf);if(conf.cone)createCone(conf);if(conf.align)ui.positionator[conf.align](conf);if(conf.classes)conf.$htmlContent.addClass(conf.classes);conf.$htmlContent.fadeIn('fast',function(){that.callbacks(conf,'show');});};that.hide=function(event,conf){that.prevent(event);$('.ui'+ui.utils.ucfirst(conf.name)).fadeOut('fast',function(event){$(this).remove();});that.callbacks(conf,'hide');};return that;}
ui.navs=function(){var that=ui.object();that.status=false;that.show=function(event,conf){that.prevent(event);that.status=true;conf.$trigger.addClass('on');conf.$htmlContent.show();that.callbacks(conf,'show');};that.hide=function(event,conf){that.prevent(event);that.status=false;conf.$trigger.removeClass('on');conf.$htmlContent.hide();that.callbacks(conf,'hide');};return that;}
ui.carousel=function(conf){var that=ui.object();var status=false;conf.$trigger=$(conf.element).addClass('uiCarousel');conf.$htmlContent=$(conf.element).find('.carousel').addClass('uiContent');var htmlElementMargin=($.browser.msie&&$.browser.version=='6.0')?21:20;var htmlContentWidth=conf.$htmlContent.children().size()*(conf.$htmlContent.children().outerWidth()+htmlElementMargin);conf.$htmlContent.wrap($('<div>').addClass('mask')).css('width',htmlContentWidth);var $mask=conf.$trigger.find('.mask');var steps=~~((conf.$trigger.width()-70)/(conf.$htmlContent.children().outerWidth()+20));steps=(steps==0)?1:steps;var moveTo=(conf.$htmlContent.children().outerWidth()+20)*steps;var margin=($mask.width()-moveTo)/2;$mask.width(moveTo).height(conf.$htmlContent.children().outerHeight());if(conf.arrows!=false)$mask.css('marginLeft',margin);var prev=function(event){if(status)return;var htmlContentPosition=conf.$htmlContent.position();status=true;conf.$htmlContent.animate({left:htmlContentPosition.left+moveTo},function(){htmlContentPosition=conf.$htmlContent.position();if(htmlContentPosition.left>=0)prevButton.hide();nextButton.show();status=false;});};if($.browser.msie&&$.browser.version=='6.0')htmlContentWidth=htmlContentWidth-(conf.$htmlContent.children().outerWidth()*2);var next=function(event){if(status)return;var htmlContentPosition=conf.$htmlContent.position();status=true;conf.$htmlContent.animate({left:htmlContentPosition.left-moveTo},function(){htmlContentPosition=conf.$htmlContent.position();if(htmlContentPosition.left+htmlContentWidth<=$mask.width())nextButton.hide();prevButton.show();status=false;});};var prevButton=$('<p>').html('Previous').addClass('prev').bind('click',prev).hide().css('top',(conf.$htmlContent.children().outerHeight()-57)/2+10);var nextButton=$('<p>').html('Next').addClass('next').bind('click',next).hide().css('top',(conf.$htmlContent.children().outerHeight()-57)/2+10);if(conf.arrows!=false){conf.$trigger.prepend(prevButton).append(nextButton);if(htmlContentWidth>$mask.width()){nextButton.show();}};return{nxt:function(event){next(event)},prv:function(event){prev(event)}}};ui.dropdown=function(conf){var that=ui.navs();$(conf.element).addClass('uiDropdown');conf.$trigger=$(conf.element).children(':first');conf.$htmlContent=conf.$trigger.next().bind('click',function(event){event.stopPropagation()});conf.$trigger.bind('click',function(event){if(that.status){that.hide(event,conf);return;};$(ui.instances.dropdown).each(function(i,e){e.hide()});that.show(event,conf);$(document).bind('click',function(event){that.hide(event,conf);$(document).unbind('click');});}).css('cursor','pointer').addClass('uiTrigger').append('<span class="ico down">&raquo;</span>');conf.$htmlContent.addClass('uiContent').find('a').bind('click',function(){hide($.Event())});var show=function(event){that.show(event,conf);};var hide=function(event){that.hide(event,conf);};return{show:function(){show($.Event())},hide:function(){hide($.Event())}};};ui.layer=function(conf){var that=ui.floats();conf.$trigger=$(conf.element);conf.align='drop';conf.cone=true;conf.classes='box';if(conf.event==='click'){conf.closeButton=true;conf.$trigger.css('cursor','pointer').bind('click',function(event){$('.uiLayer').remove();that.show(event,conf);$('.uiLayer').bind('click',function(event){event.stopPropagation()});$(document).bind('click',function(event){that.hide(event,conf);$(document).unbind('click');});});}else{conf.$trigger.css('cursor','default').bind('mouseover',function(event){$('.uiLayer').remove();that.show(event,conf);}).bind('mouseout',function(event){that.hide(event,conf);});};return{show:function(event){that.show(event,conf)},hide:function(event){that.hide(event,conf)}};};ui.modal=function(conf){var that=ui.floats();conf.$trigger=$(conf.element);conf.closeButton=true;conf.align='center';conf.classes='box';conf.ajaxType='POST';var show=function(event){if(conf.content.type.toLowerCase()==='ajax'){conf.content.data=conf.$trigger.attr('href')||conf.$trigger.parents('form').attr('action');conf.ajaxParams='x=x';if(conf.$trigger.attr('type')=='submit')setAjaxConfig();};dimmer.on();that.show(event,conf);$('.close').bind('click',hide);};var hide=function(event){dimmer.off();that.hide(event,conf);};var setAjaxConfig=function(){if(conf.content.data=='')alert('UI: Modal ajax configuration error.');conf.ajaxType=conf.$trigger.parents('form').attr('method')||'POST';var serialized=conf.$trigger.parents('form').serialize();conf.ajaxParams=conf.ajaxParams+((serialized!='')?'&'+serialized:'');};var dimmer={on:function(){$('<div>').bind('click',function(event){hide(event)}).addClass('dimmer').css({height:$(window).height(),display:'block'}).hide().appendTo('body').fadeIn();},off:function(){$('div.dimmer').fadeOut('normal',function(){$(this).remove();});}};conf.$trigger.css('cursor','pointer').bind('click',function(event){show(event)});return{show:function(){show($.Event())},hide:function(){hide($.Event())}};};ui.tabNavigator=function(conf){var $triggers=$(conf.element).children(':first').find('a');var $htmlContent=$(conf.element).children(':first').next();var instances=[];$(conf.element).addClass('uiTabNavigator');$triggers.addClass('uiTrigger');$htmlContent.addClass('uiContent box');$.each($triggers,function(i,e){instances.push(ui.tab(i,e,conf.id));});var show=function(event,tab){ui.instances.tabNavigator[conf.instance].tabs[tab].shoot(event);};return{show:function(event,tab){show(event,tab)},tabs:instances};};ui.tab=function(index,element,parent){var that=ui.navs();var display=element.href.split('#');var $tabContent=$(element).parents('.uiTabNavigator').find('#'+display[1]);that.conf={name:'tab',$trigger:$(element).addClass('uiTrigger')};var results=function(){if($tabContent.attr('id')){return $tabContent;}else{that.conf.content={type:'ajax',data:element.href};var w=$('<div>').attr('id','uiTab'+index);w.hide().appendTo(that.conf.$trigger.parents('.uiTabNavigator').find('.uiContent'));return w;};};that.conf.$htmlContent=results();if(index==0){that.status=true;that.conf.$trigger.addClass('on');};if(!that.status)that.conf.$htmlContent.hide();that.shoot=function(event){that.prevent(event);var tabs=ui.instances.tabNavigator[parent].tabs;if(tabs[index].status)return;$.each(tabs,function(i,e){if(e.status)e.hide(event,e.conf);});if(that.conf.$htmlContent.html()==='')that.conf.$htmlContent.html(that.loadContent(that.conf));that.show(event,that.conf);};that.conf.$trigger.bind('click',that.shoot);return that;}
ui.tooltip=function(conf){var that=ui.floats();conf.name='tooltip';conf.align='drop';conf.cone=true;conf.content={type:'param',data:conf.element.title};conf.$trigger=$(conf.element).css('cursor','default').bind('mouseenter',function(event){$(this).attr('title','');that.show(event,conf);}).bind('mouseleave',function(event){$(this).attr('title',conf.content.data);that.hide(event,conf);});return{show:function(event){that.show(event,conf)},hide:function(event){that.hide(event,conf)}};};ui.validator=function(conf){var that=ui.object();var formStatus=true;var watchers=[];var removeValidatorError=function(){$('.uiValidator').fadeOut('fast',function(){$(this).remove();$('.uiHelper').each(function(i,e){$(e).css('top',parseInt($(e).css('top'))-$('.uiValidator').height()-20);});});};var validations={text:function(x){return x.match(/^([a-zA-Z\s]+)$/m)},number:function(x){return x.match(/^\d+$/m)},email:function(x){return x.match(/^([\w]+)(.[\w]+)*@([\w]+)(.[\w]{2,3}){1,2}$/)},url:function(x){return x.match(/^(http:\/\/www.|https:\/\/www.|ftp:\/\/www.|www.){1}([\w]+)(.[\w]+){1,2}$/)},range:function(x,n1,n2){return validations.number(x)&&validations.min(x,n1)&&validations.max(x,n1,n2)},required:function(x){return validations.minChars($.trim(x),1);},min:function(x,n){return parseInt(x)>=n},max:function(x,n1,n2){return parseInt(x)<=n2},minChars:function(x,n){return x.toString().length>=n},maxChars:function(x,n){return x.toString().length<=n}};var validate=function(id,$element,messages,event){var helper=watchers[id].helper;for(var x in messages){if($element.parent().hasClass('disabled')&&$element.attr('disabled'))break;if(!$element.parent().hasClass('required')&&!validations.required($element.val()))break;if(!validations[x]($element.val(),$element.attr('min'),$element.attr('max'))){if(event.type==='blur')return false;$element.addClass('error');if($('.helper'+id))helper.hide();helper.show(messages[x]);return false;};};if($element.hasClass('error')){helper.hide();$element.removeClass('error');};if(event.type==='submit')return true;formStatus=true;$.each(watchers,function(i,e){if(i!=id&&!e.status)formStatus=false});if(formStatus)removeValidatorError();return true;};var Watcher=function(id,$element,messages){$element.bind('blur',function(event){watchers[id].status=validate(id,$element,messages,event)});return{status:true,helper:ui.helper(id,$element)};};for(var x in conf.fields){watchers.push(Watcher(watchers.length,$(x),conf.fields[x]));};var submit=function(event){that.prevent(event);if(!formStatus){removeValidatorError();formStatus=true;};var index=0;for(var x in conf.fields){if(!validate(index,$(x),conf.fields[x],event)){formStatus=false;}else{$(x).removeClass('error');watchers[index].helper.hide();};index++;};if(!formStatus){$(conf.element).before('<p class="uiValidator"><span class="ico error">Error: </span>'+conf.defaults.error+'</p>');$('.uiHelper').each(function(i,e){$(e).css('top',parseInt($(e).css('top'))+$('.uiValidator').height()+20);});}else{removeValidatorError();if(conf.callbacks&&conf.callbacks.submit)conf.callbacks.submit();else conf.element.submit();};};$(conf.element).find('input[type=submit]').unbind('click');$(conf.element).bind('submit',submit);return{submit:submit,watchers:watchers};};ui.helper=function(id,$element){var that=ui.floats();var conf={name:'helper',$trigger:$element,align:'right',cone:true,content:{type:'param'},classes:'helper'+id};var hide=function(){$('.helper'+id).fadeOut('fast',function(event){$(this).remove();});that.callbacks(conf,'hide');};var show=function(text){conf.content.data='<span class="ico error">Error: </span>'+text;that.show($.Event(),conf);};return{show:function(text){show(text)},hide:hide};};
ui.init();
})(jQuery);