<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>Validator - TestCases</title>
	<link rel="stylesheet" type="text/css" href="../php/css.php?q=core,forms,dropdown,layer,modal,tabNavigator,tooltip,carousel,validator">
	<link href="../libs/css/qunit.css" rel="stylesheet">
</head>
<body>

    <!-- #body -->
	<h1>Chico-UI: Validator testcases</h1>
	
	<div class="box">
		<form action="../test.html" class="formulario">
			<fieldset>
				<legend>Validadores básicos</legend>
				<p class="required">* Datos obligatorios</p>
				<ol>
					<li class="fieldBox">
						<label class="required" for="w1">
							<span>E-mail: <em>*</em></span>													
							<input type="email" id="w1" required="required">
						</label>
						<p class="help">Escribe una descripción corta y clara</p>
					</li>
					<li class="fieldBox">
						<label for="w2">
							<span>URL:</span>
							<input type="url" id="w2">
						</label>
					</li>
					<li class="fieldBox">
						<label for="w3">
							<span>Campo numérico:</span>
							<input type="number" id="w3" min="20">
						</label>
					</li>
					<li class="fieldBox">
						<label for="w4">
							<span>Rango de números:</span>
							<input type="range" id="w4" min="1" max="10">
						</label>
					</li>
					<li class="fieldBox">
						<label class="required disabled" for="w5">
							<span>Required disabled: <em>*</em></span>
							<input type="text" id="w5" required="required" disabled="disabled">
						</label>
					</li>
					<li class="fieldBox">
						<label for="w6">
							<span>Rango de carac.:</span>
							<input type="text" id="w6">
						</label>
					</li>
				</ol>
			</fieldset>
			
			<fieldset>
				<legend>Casos de uso de Selects</legend>
				<ul>
					<li class="fieldBox">
						<label for="pruebaSelect">
							<span>Select:</span>
							<select id="pruebaSelect">
								<option value="-1">Selecciona algo...</option>
								<option value="1">opcion 1</option>
								<option value="2">opcion 2</option>
								<option value="3">opcion 3</option>
								<option value="4">opcion 4</option>
							</select>
						</label>
					</li>
					
					<li class="fieldBox">
						<label for="pruebaSelect2" class="required">
							<span>Select obl: <em>*</em></span>
							<select id="pruebaSelect2" required="required">
								<option value="-1">Selecciona algo...</option>
								<option value="1">opcion 1</option>
								<option value="2">opcion 2</option>
								<option value="3">opcion 3</option>
								<option value="4">opcion 4</option>
							</select>
						</label>
					</li>
					
					<li class="fieldBox">
						<label for="pruebaSelect3" class="required disabled">
							<span>Required & disabl.: <em>*</em></span>
							<select id="pruebaSelect3" required="required" disabled="disabled">
								<option value="-1">Selecciona algo...</option>
								<option value="1">opcion 1</option>
								<option value="2">opcion 2</option>
								<option value="3">opcion 3</option>
								<option value="4">opcion 4</option>
							</select>
						</label>
					</li>
					
					<li class="fieldBox">
						<label for="pruebaSelect4" class="disabled">
							<span>Select disabled:</span>
							<select id="pruebaSelect4" disabled="disabled">
								<option value="-1">Selecciona algo...</option>
								<option value="1">opcion 1</option>
								<option value="2">opcion 2</option>
								<option value="3">opcion 3</option>
								<option value="4">opcion 4</option>
							</select>
						</label>
					</li>
				</ul>
			</fieldset>
			
			<fieldset>
				<legend>Legend de grupo</legend>
				<div class="esta options">
					<h4>dsjaidjsaoi:</h4>
					<ul>
						<li class="fieldBox">
							<label for="432">
								<input type="checkbox" value="3" id="432" name="cantidad">
								<span>Tres</span>
							</label>
						</li>
						
						<li class="fieldBox">
							<label for="433">
								<input type="checkbox" value="4" id="433" name="cantidad">
								<span>Cuatro</span>
							</label>
						</li>
					</ul>
				</div>
			</fieldset>
			
			<fieldset>
				<legend>Legend de grupo <em>*</em></legend>
				<div class="este options required">
					<ul>
						<li class="fieldBox">
							<label for="765">
								<input type="checkbox" value="3" id="765" name="cantidad2">
								<span>Tres</span>
							</label>
						</li>
						
						<li class="fieldBox">
							<label for="654">
								<input type="checkbox" value="4" id="654" name="cantidad2">
								<span>Cuatro</span>
							</label>
						</li>
					</ul>
				</div>
			</fieldset>
			
			<fieldset>
				<legend>Legend de grupo</legend>
				<div class="esto required options">
					<h4>dsjaidjsaoi: <em>*</em></h4>
					<ul>
						<li class="fieldBox">
							<label for="123">
								<input type="radio" value="3" id="123" name="cantidad3">
								<span>Tres</span>
							</label>
						</li>
						
						<li class="fieldBox">
							<label for="234">
								<input type="radio" value="4" id="234" name="cantidad3">
								<span>Cuatro</span>
							</label>
						</li>
					</ul>
				</div>
			</fieldset>
			
			<fieldset>
				<legend>Legend de grupo</legend>
				<div class="estu options">
					<ul>
						<li class="fieldBox">
							<label for="345">
								<input type="radio" value="3" id="345" name="cantidad4">
								<span>Tres</span>
							</label>
						</li>
						
						<li class="fieldBox">
							<label for="456">
								<input type="radio" value="4" id="456" name="cantidad4">
								<span>Cuatro</span>
							</label>
						</li>
					</ul>
				</div>
			</fieldset>
			
			<div class="tyc options required">
				<label for="w19a">
					<input type="checkbox" value="yes" id="w19a" name="tyc">
					<span>He leído y acepto los Términos y Condiciones de servicio.</span>
				</label>
			</div>
			
			<fieldset>
				<legend>Textarea</legend>
				
				<ul>
					<li class="fieldBox">
						<label for="testTextarea1">
							<span>Textarea:</span>
							<textarea id="testTextarea1"></textarea>
						</label>
					</li>
					
					<li class="fieldBox">
						<label for="testTextarea2" class="required">
							<span>Textarea obli: <em>*</em></span>
							<textarea id="testTextarea2" required="required"></textarea>
						</label>
					</li>
					
					<li class="fieldBox">
						<label for="testTextarea3" class="required disabled">
							<span>Oblig. + disab: <em>*</em></span>
							<textarea id="testTextarea3" required="required" disabled="disabled"></textarea>
						</label>
					</li>
					
					<li class="fieldBox">
						<label for="testTextarea4" class="disabled">
							<span>Textarea disabled:</span>
							<textarea id="testTextarea4" disabled="disabled"></textarea>
						</label>
					</li>
				</ul>
				
			</fieldset>
			
			<p class="actions">
				<input type="submit" value="Submit" id="validationModalTest" class="btn primary">
				<a href="#">Cancelar</a>
			</p>
		</form>
	</div>
<!-- #body -->	
	<hr>
	<h1 id="qunit-header">QUnit Test Suite</h1>
	<h2 id="qunit-banner"></h2>
	<div id="qunit-testrunner-toolbar"></div>
	<h2 id="qunit-userAgent"></h2>
	<ol id="qunit-tests"></ol>
	<div id="qunit-fixture">test markup</div>

	<script src="../libs/js/jquery.js"></script>
	<script src="../libs/js/qunit.js"></script>
	<script src="../php/chico.php?get=validator&debug=true"></script>
	<script src="functions.js"></script>
	
<!-- #script -->
	<script>
		// Validator
		var testValidator = $('.formulario').validator({
			fields: {
				// Inputs
				'#w1': {
					required: 'El email es obligatorio.',
					email: 'El email esta mal escrito.'
				},

				'#w2': {
					url: 'La URL esta mal escrita.'
				},

				'#w3': {
					number: 'El precio debe ser un número.',
					min: 'El precio debe ser mayor a 20.'
				},

				'#w4': {
					range: 'El rango debe ser un número entre 1 y 10.'
				},
			
				'#w5': {
					required: 'El campo es obligatorio.'
				},
				
				'#w6': {
					maxLength: [20, 'El campo debe tener menos de 20 caracteres.'],
					minLength: [6, 'El campo debe tener más de 6 caracteres.']
				},
				
				// Selects
				'#pruebaSelect2': {
					required: 'El campo es obligatorio.'
				},

				'#pruebaSelect3': {
					required: 'El campo es obligatorio.'
				},
				
				// Options
				'.este': {
					required: 'El campo es obligatorio.'
				},
				
				'.esto': {
					required: 'El campo es obligatorio.'
				},
				
				'.tyc': {
					required: 'El campo es obligatorio.'
				},
				
				// Textareas
				'#testTextarea2': {
					required: 'El campo es obligatorio.'
				},
				
				'#testTextarea3': {
					required: 'El campo es obligatorio.'
				}
			},
			defaults: {
				error: 'Hay errores en el formulario.'
			},
			callbacks: {
				submit: function(){
					alert('callback');
				}
			}
		});
	
		$.fx.off = true;
		
		/**
		 * 	Test Cases
		 */
        
        module("Validator basics instance object");
        
        test("Basics for testValidator instance", function(){

			expect( 5 + (testValidator.fields.length * 4) );

       		ok( testValidator.uid >= 0 , "Expected to find a defined content on the validator instance");
       		
    		ok( testValidator.type == "ui.validator" , "Expected to find \"ui.validator\" as value of type attribute");

			var form = document.getElementsByTagName("form")[0];		

    		ok( testValidator.element === form , "Expected to find a element propiertie with an DOM reference");
    		  		
			ok( $.isFunction(testValidator.validate) , "Expected to find a validate method validator instance");

 			ok( $.isArray(testValidator.fields) && testValidator.fields.length > 0 , "Expected to find an array of fields on the validator instance with more than 1 items on it");

			$(testValidator.fields).each(function(i,e){
				
				ok( typeof e.status == "boolean" , "Expected to find a boolean status on field number " + i);
			
				ok( $.isPlainObject(e.helper) , "Expected to find a helper object on field number " + i);	
				
				ok( $.isFunction(e.helper.show) , "Expected to find a show() method in the helper object");
				
				ok( $.isFunction(e.helper.hide) , "Expected to find a hide() method in the helper object");
				
			});

        });
        
		module('Validator layout and interaction');

		console.log(testValidator);

		test('Submits form with error in all fields', function(){
			$('#w1, #w2, #w3, #w4, #w6').val('abc');
			
			$('form').submit();
			
			// Validation exists
			exists('.ui-validator');
			
			// Class error
			$('#w1, #w2, #w3, #w4, #w6, #pruebaSelect2, #testTextarea2').each(function(){ hasClass(this, 'error') });
			
			// Helpers (12)
			for(var i = 0; i < 12; i ++){
				// Except disabled fields
				if(i != 4 && i != 7) exists('.helper' + i); else notExists('.helper' + i);
			};
		});
		
		test('Corrects each fields and blur', function(){
			// Required email
			$('#w1').val('').blur();
			hasClass('#w1', 'error'); // TODO: Validator: deberia cambiar el mensaje
			exists('.helper0');
			
			$('#w1').val('abc@abc.com').blur();
			hasNotClass('#w1', 'error');
			notExists('.helper0');
			
			// URL
			$('#w2').val('http://www.mercadolibre.com').blur();
			hasNotClass('#w2', 'error');
			notExists('.helper1');
			
			// Number (>20)
			$('#w3').val('12').blur();
			hasClass('#w3', 'error');
			exists('.helper2');
			
			$('#w3').val('25').blur();
			hasNotClass('#w3', 'error');
			notExists('.helper2');
			
			// Range (between 1 and 10)
			$('#w4').val('0').blur();
			hasClass('#w4', 'error');
			exists('.helper3');
			
			$('#w4').val('20').blur();
			hasClass('#w4', 'error');
			exists('.helper3');
			
			$('#w4').val('5').blur();
			hasNotClass('#w4', 'error');
			notExists('.helper3');
			
			// MinLength = 6, MaxLength = 20
			$('#w6').val('abc').blur();
			hasClass('#w6', 'error');
			exists('.helper5');
			
			$('#w6').val('abcdefghijklmnopqrstuvwxyz').blur();
			hasClass('#w6', 'error');
			exists('.helper5');
			
			$('#w6').val('abcdefghijkl').blur();
			hasNotClass('#w6', 'error');
			notExists('.helper5');
			
			// Select
			$('#pruebaSelect2 option[selected]').removeAttr('selected');
			$('#pruebaSelect2 option[value=1]').attr('selected', 'selected');
			$('#pruebaSelect2').blur();
			hasNotClass('#pruebaSelect2', 'error');
			notExists('.helper6');
			
			// Textarea
			$('#testTextarea2').html('abc').blur();
			hasNotClass('#testTextarea2', 'error');
			notExists('.helper11');
			
			// Checkboxes & Radio buttons TODO: Validator: No funcionan con blur
			$('#765, #123, #w19a').click();
		});
		
		test('Submits form with error corrected', function(){
			$('form').submit();
			
			// Validation exists
			notExists('.ui-validator');
			
			// Class error
			$('#w1, #w2, #w3, #w4, #w6, #pruebaSelect2, #testTextarea2').each(function(){ hasNotClass(this, 'error') });
			
			// Helpers (12)
			for(var i = 0; i < 12; i ++){
				// Except disabled fields
				notExists('.helper' + i);
			};
		});
		
		// TODO: test que cuando se corrigen todos los campos, se elimina el tophelper

	</script>

</body>
</html>
